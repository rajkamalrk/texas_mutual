{"order_seq_no": 1,"record_type":"M25_Summary_load","df_table_name": "read_m25_summary_data_vw","db_table_name": "txm_ndc.ndc_summary_data","db_select_cols_list": "", "db_filter_id_col_name": "","transform_sql_select":"SELECT MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CDC' AND SUBSTR(ndc_data_str,5,3) = '020' THEN TO_DATE(TRIM(SUBSTR(ndc_data_str,10,9)),'yyyyMMdd') END) AS summary_create_date,MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CDE' AND TRIM(SUBSTR(ndc_data_str,5,3)) = '020' THEN TO_DATE(TRIM(SUBSTR(ndc_data_str,10,9)),'yyyyMMdd') END)  AS summary_expire_date,MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CDI' AND TRIM(SUBSTR(ndc_data_str,5,3)) = '020' THEN TO_DATE(TRIM(SUBSTR(ndc_data_str,10,9)),'yyyyMMdd') END) AS summary_issue_date,MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CDK' AND TRIM(SUBSTR(ndc_data_str,5,3)) = '020' THEN TO_DATE(TRIM(SUBSTR(ndc_data_str,10,9)),'yyyyMMdd') END) AS summary_kill_date,MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CFM' AND TRIM(SUBSTR(ndc_data_str,5,3)) = '020' THEN TRIM(SUBSTR(ndc_data_str,10,2)) END) AS product_file_mode,MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CFT' AND TRIM(SUBSTR(ndc_data_str,5,3)) = '020' THEN TRIM(SUBSTR(ndc_data_str,10,2)) END) AS product_file_type,MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CVL' AND TRIM(SUBSTR(ndc_data_str,5,3)) = '030' THEN TRIM(SUBSTR(ndc_data_str,11,5)) END) AS volume_number,MAX(CASE WHEN TRIM(SUBSTR(ndc_data_str,1,3)) = 'CVL' AND TRIM(SUBSTR(ndc_data_str,5,3)) = '030' THEN TRIM(SUBSTR(ndc_data_str,17,2)) END) AS supplement_number,MAX(CASE WHEN SUBSTR(ndc_data_str,1,3) = 'TOC' AND SUBSTR(ndc_data_str,5,3) = '160' AND SUBSTR(ndc_data_str,14,3) = '006' THEN CASE WHEN SUBSTR(ndc_data_str, 31, 7) REGEXP '^[0-9]+$' THEN SUBSTR(ndc_data_str, 31, 7) ELSE NULL END  END) AS m25data_record_count FROM read_m25_summary_data_vw","cdc_retrieval":"","validation":""}
{"order_seq_no": 2,"record_type":"M25_load","df_table_name": "read_m25_data_vw","db_table_name": "txm_ndc.ndc_data","db_select_cols_list": "","db_filter_id_col_name": "","transform_sql_select":"WITH M1 AS (SELECT TRIM(SUBSTR(ndc_data_str, 1, 11)) AS ndc_code ,CAST(NULLIF(TRIM(SUBSTR(ndc_data_str, 17, 8)) ||'.'|| TRIM(SUBSTR(ndc_data_str, 25,5)), '.') AS DECIMAL(13,2)) AS ndc_strength ,TRIM(SUBSTR(ndc_data_str, 30, 10)) AS ndc_unit_of_measure FROM read_m25_data_vw WHERE TRIM(SUBSTR(ndc_data_str, 13, 2)) ='M1') ,E1 AS (SELECT TRIM(SUBSTR(ndc_data_str, 1, 11)) AS ndc_code ,TRIM(SUBSTR(ndc_data_str, 17, 25)) AS ndc_name ,TRIM(SUBSTR(ndc_data_str, 42, 25)) AS ndc_name_extension FROM read_m25_data_vw WHERE TRIM(SUBSTR(ndc_data_str, 13, 2)) ='E1') ,A1 AS (SELECT TRIM(SUBSTR(ndc_data_str, 1, 11)) AS ndc_code ,TRIM(SUBSTR(ndc_data_str, 50, 1)) AS ndc_item_status ,CAST(NULL AS DATE) AS ndc_status_change_date FROM read_m25_data_vw WHERE TRIM(SUBSTR(ndc_data_str, 13, 2)) ='A1') SELECT M1.ndc_code,E1.ndc_name,E1.ndc_name_extension,A1.ndc_item_status,A1.ndc_status_change_date,M1.ndc_strength,M1.ndc_unit_of_measure  FROM M1 INNER JOIN A1 ON A1.ndc_code=M1.ndc_code INNER JOIN E1 ON E1.ndc_code=M1.ndc_code","cdc_retrieval":"SELECT s.ndc_code,s.ndc_name,s.ndc_name_extension,s.ndc_item_status,s.ndc_status_change_date,s.ndc_unit_of_measure,s.ndc_strength,'Insert' AS record_type FROM src_tbl s LEFT OUTER JOIN tgt_tbl d ON d.ndc_code=s.ndc_code WHERE d.ndc_code IS NULL UNION ALL SELECT s.ndc_code,s.ndc_name,s.ndc_name_extension,s.ndc_item_status,IF(s.ndc_item_status!=d.ndc_item_status,current_date(),d.ndc_status_change_date) AS ndc_status_change_date,s.ndc_unit_of_measure,s.ndc_strength,'Update' AS record_type FROM src_tbl s INNER JOIN tgt_tbl d ON d.ndc_code=s.ndc_code AND ((IFNULL(d.ndc_name,'')!= IFNULL(s.ndc_name,'')) OR (IFNULL(d.ndc_name_extension,'') != IFNULL(s.ndc_name_extension,'')) OR (IFNULL(s.ndc_strength,'')!=IFNULL(d.ndc_strength,'') ) OR (IFNULL(s.ndc_unit_of_measure,'')!=IFNULL(d.ndc_unit_of_measure,'') ) OR (IFNULL(s.ndc_item_status,'')!=IFNULL(d.ndc_item_status,'')))","validation":"SELECT (SELECT Max(ndc_summary_id) FROM txm_ndc.ndc_summary_data) AS ndc_summary_id,CASE WHEN summary_create_date IS NULL THEN 'Summary Control Record Missing' WHEN COUNT(*) > 1 THEN 'Multiple Unprocessed Summary Control Records' ELSE 'PASS' END AS validation_result FROM txm_ndc.ndc_summary_data WHERE summary_issue_date = '<issue_date>'"}