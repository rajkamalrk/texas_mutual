{"order_seq_no":1,"form_type":"DWC066","table_type":"BILL_HEADER","df_read_table_name":"read_bill_header_vw","df_table_name":"bill_header_vw","db_table_name":"txm_bitx.bill_header","db_select_cols_list":"bill_id,bill_header_id","load_config_table_list":"bitx_static_config.eob_pec_codes","db_filter_id_col_name":"file_header_id","db_read_sql_select":"WITH unique_groups AS (SELECT MIN(invoice_header_id) AS new_invoice_header_id,SUM(CAST(tax_amount AS DECIMAL(10, 2))) AS total_tax_amount, MAX(date_filled) AS max_date_filled, claim_number, pharmacy_address1, pharmacy_address2, pharmacy_city, pharmacy_state, pharmacy_zip,dispensing_pharmacy_npi,prescriber_npi FROM txm_bitx_staging.optum_invoice WHERE file_header_id=<INPUT_FILE_HEADER_ID> GROUP BY COALESCE(claim_number, 'dummy_claim_number'), COALESCE(pharmacy_address1, 'dummy_pharmacy_address1'), COALESCE(pharmacy_address2, 'dummy_pharmacy_address2'), COALESCE(pharmacy_city, 'dummy_pharmacy_city'), COALESCE(pharmacy_state, 'dummy_pharmacy_state'), COALESCE(pharmacy_zip, 'dummy_pharmacy_zip'),COALESCE(dispensing_pharmacy_npi, 'dummy_dispensing_pharmacy_npi'),COALESCE(prescriber_npi, 'dummy_prescriber_npi')) SELECT ug.new_invoice_header_id AS bill_header_id,ug.total_tax_amount AS total_tax_amount, 'optum' AS trading_partner, 'RX' AS form_type, b.file_header_id AS file_header_id, b.invoice_number AS invoice_number, b.claim_number AS reported_claim_number, b.date_written AS date_of_bill, CASE WHEN ug.max_date_filled IS NULL THEN COALESCE(b.date_received, b.bill_calculation_date) ELSE ug.max_date_filled END AS date_bill_received_by_payer, b.sequence AS sequence, b.pre_auth AS pre_authorization_number, b.error_code AS error_code, b.bill_type AS bill_type, b.pbm_rx_no AS unique_bill_id, b.network FROM txm_bitx_staging.optum_invoice b JOIN unique_groups ug ON ug.new_invoice_header_id = b.invoice_header_id WHERE b.file_header_id =<INPUT_FILE_HEADER_ID>","transform_sql_select":"SELECT trading_partner,total_tax_amount,form_type,file_header_id,bill_header_id,invoice_number,reported_claim_number,date_of_bill,date_bill_received_by_payer,sequence,pre_authorization_number,error_code,bill_type,unique_bill_id,network,CASE WHEN h.error_code = '3' OR h.error_code = '7' THEN e.default_eob WHEN h.network = 'Y' THEN e.in_network_eob ELSE e.out_network_eob END AS explanation_of_benefits,CASE WHEN h.error_code = '3' OR h.error_code = '7' THEN e.default_pec WHEN h.network = 'Y' THEN e.in_network_pec ELSE e.out_network_pec END AS pec FROM read_bill_header_vw h CROSS JOIN (SELECT * FROM eob_pec_codes_vw LIMIT 1) e"}
{"order_seq_no":2,"form_type":"DWC066","table_type":"BILL_DETAIL","df_read_table_name":"read_patient_vw","df_table_name":"patient_vw","db_table_name":"txm_bitx.patient","db_select_cols_list":"bill_id","load_config_table_list":"","db_filter_id_col_name":"bill_id","db_read_sql_select":"WITH unique_groups AS (SELECT MIN(invoice_header_id) AS new_invoice_header_id, GROUP_CONCAT(invoice_header_id) AS group_id_list, claim_number, pharmacy_address1, pharmacy_address2, pharmacy_city, pharmacy_state, pharmacy_zip,dispensing_pharmacy_npi,prescriber_npi FROM txm_bitx_staging.optum_invoice WHERE file_header_id = <INPUT_FILE_HEADER_ID> GROUP BY COALESCE(claim_number,'dummy_claim_number'), COALESCE(pharmacy_address1,'dummy_pharmacy_address1'), COALESCE(pharmacy_address2,'dummy_pharmacy_address2'), COALESCE(pharmacy_city,'dummy_pharmacy_city'), COALESCE(pharmacy_state,'dummy_pharmacy_state'), COALESCE(pharmacy_zip,'dummy_pharmacy_zip'),COALESCE(dispensing_pharmacy_npi, 'dummy_dispensing_pharmacy_npi'),COALESCE(prescriber_npi, 'dummy_prescriber_npi')) SELECT DISTINCT ug.new_invoice_header_id AS bill_header_id,b.ssn AS social_security_number, TRIM(CONCAT_WS(', ',NULLIF(TRIM(COALESCE(b.member_last_name, '')), ''),NULLIF(TRIM(COALESCE(b.member_first_name, '')), ''),NULLIF(TRIM(COALESCE(b.member_middle_init, '')), ''))) AS patient_name,COALESCE(NULLIF(TRIM(b.employee_dob),''),c.date_of_birth) AS date_of_birth,COALESCE(NULLIF(TRIM(b.employee_gender),''),c.patient_gender) AS patient_gender,COALESCE(NULLIF(TRIM(c.date_of_injury),''),b.date_of_injury) AS date_of_injury,c.patient_address_line_1 AS patient_address_line_1,c.patient_address_line_2 AS patient_address_line_2,c.patient_city AS patient_city,c.patient_state_code AS patient_state_code,TRIM(REPLACE(c.patient_zip_code,'-','')) AS zip_code,c.patient_phone_number AS patient_phone_number FROM txm_bitx_staging.optum_invoice b JOIN unique_groups ug ON FIND_IN_SET(b.invoice_header_id, ug.group_id_list) > 0 LEFT JOIN txm_bitx_staging.claim_data c ON c.trading_partner='optum' AND  b.file_header_id=c.file_header_id AND b.invoice_header_id=c.bill_header_id where b.file_header_id=<INPUT_FILE_HEADER_ID>","transform_sql_select":"select h.bill_id,social_security_number,patient_name,date_of_birth,patient_gender,date_of_injury,patient_phone_number,zip_code,patient_state_code,patient_city,patient_address_line_2,patient_address_line_1 FROM read_patient_vw v JOIN db_bill_header_vw h ON h.bill_header_id=v.bill_header_id"}
{"order_seq_no":3,"form_type":"DWC066","table_type":"BILL_DETAIL","df_read_table_name":"read_subscriber_vw","df_table_name":"subscriber_vw","db_table_name":"txm_bitx.subscriber","db_select_cols_list":"bill_id","load_config_table_list":"","db_filter_id_col_name":"bill_id","db_read_sql_select":"WITH unique_groups AS (SELECT MIN(invoice_header_id) AS new_invoice_header_id, GROUP_CONCAT(invoice_header_id) AS group_id_list, claim_number, pharmacy_address1, pharmacy_address2, pharmacy_city, pharmacy_state, pharmacy_zip,dispensing_pharmacy_npi,prescriber_npi FROM txm_bitx_staging.optum_invoice WHERE file_header_id = <INPUT_FILE_HEADER_ID> GROUP BY COALESCE(claim_number,'dummy_claim_number'), COALESCE(pharmacy_address1,'dummy_pharmacy_address1'), COALESCE(pharmacy_address2,'dummy_pharmacy_address2'), COALESCE(pharmacy_city,'dummy_pharmacy_city'), COALESCE(pharmacy_state,'dummy_pharmacy_state'), COALESCE(pharmacy_zip,'dummy_pharmacy_zip'),COALESCE(dispensing_pharmacy_npi, 'dummy_dispensing_pharmacy_npi'),COALESCE(prescriber_npi, 'dummy_prescriber_npi')) SELECT DISTINCT ug.new_invoice_header_id AS bill_header_id, COALESCE(NULLIF(TRIM(c.subscriber_tax_id),''), TRIM(b.employer_code) ) AS subscriber_tax_id, COALESCE(NULLIF(TRIM(c.subscriber_name),''), TRIM(b.employer_name)) AS subscriber_name, COALESCE(NULLIF(TRIM(c.subscriber_address_line_1),''), TRIM(b.employer_address1)) AS subscriber_address_line_1, TRIM(c.subscriber_address_line_2) AS subscriber_address_line_2, COALESCE(NULLIF(TRIM(c.subscriber_city),''), TRIM(b.employer_city)) AS subscriber_city, COALESCE(NULLIF(TRIM(c.subscriber_state),''), TRIM(b.employer_state)) AS subscriber_state, COALESCE(NULLIF(TRIM(REPLACE(subscriber_zip_code,'-','')),''), TRIM(b.employer_zip_code)) AS zip_code, c.subscriber_telephone_number AS subscriber_telephone_number, b.employer_code AS employer_code, CASE WHEN LEFT(c.insured_policy_number,1)='Q' THEN 0 WHEN c.insured_policy_number REGEXP '^[0-9]+$' THEN LEFT(c.insured_policy_number,10) ELSE 0 END AS insured_policy_number FROM txm_bitx_staging.optum_invoice b JOIN unique_groups ug ON FIND_IN_SET(b.invoice_header_id, ug.group_id_list) > 0 LEFT JOIN txm_bitx_staging.claim_data c ON c.trading_partner='optum' AND b.file_header_id=c.file_header_id AND b.invoice_header_id=c.bill_header_id WHERE b.file_header_id=<INPUT_FILE_HEADER_ID>","transform_sql_select":"SELECT h.bill_id AS bill_id, subscriber_tax_id, subscriber_name, subscriber_address_line_1, subscriber_address_line_2, subscriber_city, subscriber_state, zip_code, subscriber_telephone_number, insured_policy_number, employer_code FROM read_subscriber_vw v JOIN db_bill_header_vw h ON h.bill_header_id=v.bill_header_id"}
{"order_seq_no":4,"form_type":"DWC066","table_type":"BILL_DETAIL","df_read_table_name":"read_provider_vw","df_table_name":"provider_vw","db_table_name":"txm_bitx.provider","db_select_cols_list":"bill_id","load_config_table_list":"bitx_static_config.common_static_configuration","db_filter_id_col_name":"bill_id","db_read_sql_select":"WITH unique_groups AS (SELECT MIN(invoice_header_id) AS new_invoice_header_id, GROUP_CONCAT(invoice_header_id) AS group_id_list, claim_number, pharmacy_address1, pharmacy_address2, pharmacy_city, pharmacy_state, pharmacy_zip,dispensing_pharmacy_npi,prescriber_npi FROM txm_bitx_staging.optum_invoice WHERE file_header_id = <INPUT_FILE_HEADER_ID> GROUP BY COALESCE(claim_number,'dummy_claim_number'), COALESCE(pharmacy_address1,'dummy_pharmacy_address1'), COALESCE(pharmacy_address2,'dummy_pharmacy_address2'), COALESCE(pharmacy_city,'dummy_pharmacy_city'), COALESCE(pharmacy_state,'dummy_pharmacy_state'), COALESCE(pharmacy_zip,'dummy_pharmacy_zip'),COALESCE(dispensing_pharmacy_npi, 'dummy_dispensing_pharmacy_npi'),COALESCE(prescriber_npi, 'dummy_prescriber_npi')) SELECT DISTINCT ug.new_invoice_header_id AS bill_header_id, CASE WHEN b.dea IS NOT NULL AND TRIM(b.dea) <> '' THEN TRIM(b.dea) ELSE NULL END AS rendering_provider_dea_number, CASE WHEN b.physician_address IS NOT NULL AND b.physician_address <> '' THEN b.physician_address ELSE NULL END AS referring_provider_address_1, CASE WHEN b.physician_address IS NOT NULL AND b.physician_address <> '' THEN b.physician_city ELSE NULL END AS referring_provider_city, CASE WHEN b.physician_address IS NOT NULL AND b.physician_address <> '' THEN b.physician_state ELSE NULL END AS referring_provider_state, CASE WHEN b.physician_address IS NOT NULL AND b.physician_address <> '' THEN b.physician_zip_code ELSE NULL END AS referring_provider_zip_code, b.prescriber_npi AS referring_provider_npi, b.pharmacy_name AS rendering_provider_name,b.pharmacy_name AS facility_name, b.pharmacy_address1 AS facility_address_1, b.pharmacy_address2 AS facility_address_2, b.pharmacy_city AS facility_city, b.pharmacy_state AS facility_state, b.pharmacy_zip AS facility_zip_code, b.sn_name AS vendor_name, b.sn_address1 AS vendor_address_1, b.sn_address2 AS vendor_address_2, b.sn_city AS vendor_city, b.sn_state AS vendor_state, b.sn_zip_code AS vendor_zip_code, b.pharmacy_phone_number AS vendor_phone_number, b.dispensing_pharmacy_npi AS rendering_provider_npi, TRIM(CONCAT_WS(', ', NULLIF(TRIM(COALESCE(b.physician_last_name, '')), ''), CASE WHEN TRIM(COALESCE(b.physician_middle_init, '')) <> '' THEN CONCAT(TRIM(COALESCE(b.physician_first_name, '')), ' ', TRIM(COALESCE(b.physician_middle_init, ''))) ELSE TRIM(COALESCE(b.physician_first_name, '')) END)) AS referring_provider_name,TRIM(nabp) AS rendering_provider_nabp FROM txm_bitx_staging.optum_invoice b JOIN unique_groups ug ON b.invoice_header_id = ug.new_invoice_header_id WHERE b.file_header_id=<INPUT_FILE_HEADER_ID>","transform_sql_select":"SELECT h.bill_id AS bill_id,rendering_provider_dea_number,referring_provider_address_1,referring_provider_city,referring_provider_state,referring_provider_zip_code,referring_provider_npi,rendering_provider_name,facility_name,facility_address_1,facility_address_2,facility_city,facility_state,facility_zip_code,vendor_phone_number,rendering_provider_npi,referring_provider_name,t.attribute_value AS vendor_tax_id,vendor_name,vendor_address_1,vendor_address_2,vendor_city,vendor_state,vendor_zip_code,validate_NABP_udf(v.rendering_provider_nabp) AS rendering_provider_nabp FROM read_provider_vw v JOIN db_bill_header_vw h ON h.bill_header_id=v.bill_header_id LEFT JOIN common_static_configuration_vw t ON t.attribute_name = 'optum_default_tax_id'"}
{"order_seq_no":5,"form_type":"DWC066","table_type":"PHARMACY_LINE","df_read_table_name":"read_pharmacy_line_vw","df_table_name":"pharmacy_line_vw","db_table_name":"txm_bitx.pharmacy_line","db_select_cols_list":"","load_config_table_list":"","db_filter_id_col_name":"","db_read_sql_select":"WITH unique_groups AS (SELECT MIN(invoice_header_id) AS new_invoice_header_id, GROUP_CONCAT(invoice_header_id) AS group_id_list, claim_number, pharmacy_address1, pharmacy_address2, pharmacy_city, pharmacy_state, pharmacy_zip,dispensing_pharmacy_npi,prescriber_npi FROM txm_bitx_staging.optum_invoice WHERE file_header_id = <INPUT_FILE_HEADER_ID> GROUP BY COALESCE(claim_number, ''), COALESCE(pharmacy_address1, ''), COALESCE(pharmacy_address2, ''), COALESCE(pharmacy_city, ''), COALESCE(pharmacy_state, ''), COALESCE(pharmacy_zip, ''),COALESCE(dispensing_pharmacy_npi, 'dummy_dispensing_pharmacy_npi'),COALESCE(prescriber_npi, 'dummy_prescriber_npi')) SELECT ug.new_invoice_header_id AS bill_header_id,b.generic_available_ndc AS generic_available,b.generic AS generic_dispensed,b.daw_cde AS dispensed_as_written_code,b.ndc AS ndc_code,CASE WHEN b.rx_quantity > 9999 THEN 9999 ELSE b.rx_quantity END AS quantity,CAST(CASE WHEN b.days_supply IS NULL OR TRIM(b.days_supply) = '' THEN '000' WHEN TRIM(SUBSTRING(b.days_supply, 2, 2)) = '' THEN CONCAT(SUBSTRING(b.days_supply, 1, 1), '00') WHEN SUBSTRING(b.days_supply, 3, 1) = ' ' THEN CONCAT(SUBSTRING(b.days_supply, 1, 2), '0') ELSE b.days_supply END AS UNSIGNED) AS days_supply,CAST(CASE WHEN b.refill IS NULL OR  TRIM(b.refill) = '' THEN '000' WHEN TRIM(SUBSTRING(b.refill, 2, 2)) = '' THEN CONCAT(SUBSTRING(b.refill, 1, 1), '00') WHEN SUBSTRING(b.refill, 3, 1) = ' ' THEN CONCAT(SUBSTRING(b.refill, 1, 2), '0') ELSE b.refill END AS UNSIGNED INTEGER) AS fill_count,b.drug_name AS drug_name,b.rx_number AS prescription_number,b.bill_calculation_date AS bill_calculation_date,b.tax_amount AS tax_amount,b.charged_amount AS charged_amount,b.fee_schedule AS fee_schedule,b.contract_amount AS contract_amount,b.cost_amount AS cost_amount,b.patient_pay_amount AS total_prior_payments,GREATEST(CASE WHEN CAST(b.charged_amount AS DECIMAL(10,2)) < CAST(b.fee_schedule AS DECIMAL(10,2)) THEN CAST(b.charged_amount AS DECIMAL(10,2)) - CAST(b.contract_amount AS DECIMAL(10,2)) ELSE CAST(b.fee_schedule AS DECIMAL(10,2)) - CAST(b.contract_amount AS DECIMAL(10,2)) END,0) AS ppo_reductions,b.recommended_amount AS recommended_amount, b.date_filled AS service_from_date, b.date_filled AS service_thru_date,b.date_filled AS prescription_date FROM txm_bitx_staging.optum_invoice b JOIN unique_groups ug ON FIND_IN_SET(b.invoice_header_id, ug.group_id_list) > 0 WHERE b.file_header_id = <INPUT_FILE_HEADER_ID>","transform_sql_select":"SELECT h.bill_id AS bill_id,generic_available,generic_dispensed,dispensed_as_written_code,ndc_code,quantity,days_supply,fill_count,drug_name,prescription_number,bill_calculation_date,tax_amount,charged_amount,fee_schedule,contract_amount,cost_amount,total_prior_payments,ppo_reductions,recommended_amount,service_from_date,service_thru_date,prescription_date,ROW_NUMBER() OVER (partition by h.bill_id ORDER BY h.bill_id ) AS line_number FROM read_pharmacy_line_vw v JOIN db_bill_header_vw h on h.bill_header_id=v.bill_header_id"}